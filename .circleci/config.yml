version: 2
jobs:
  build:
    docker:
      - image: circleci/python:3.8
    steps:
      # Step 1: obtain repo from GitHub
      - checkout
      # Step 2: Install Python and dependencies
      - run:
          name: create venv and install dependencies
          command: |
            virtualenv env
            source env/bin/activate
            pip install -r requirements.txt
      - run:
          name: Run unit test
          command: |
            source env/bin/activate
            python test_application.py
     
  # push-to-dockerhub:
  #   docker:
  #     - image: cimg/base:2022.06
  #   steps:
  #     - checkout
  #     - setup_remote_docker:
  #         docker_layer_caching: true
  #         version: 19.03.13
  #     - deploy:
  #         name: Push application Docker image
  #         command: |
  #           docker build -t "${DOCKERHUB_USERNAME}/${CIRCLE_PROJECT_REPONAME}:${CIRCLE_SHA1}" .
  #           docker login -u "${DOCKERHUB_USERNAME}" -p "${DOCKERHUB_PAT}"
  #           docker push "${DOCKERHUB_USERNAME}/${CIRCLE_PROJECT_REPONAME}:${CIRCLE_SHA1}"
  
  update-yaml-with-details:
    docker:
      - image: cimg/base:2022.06
    steps:
      - install-yq

            
workflows:
  version: 2
  build-and-deploy:
    jobs:
      - build:
          filters:
            branches:
              only: main
      - update-yaml-with-details:
          requires:
            - build
